# ChronosArchiver Configuration
# Copy this file to config.yaml and adjust settings

# Archive settings
archive:
  # Directory to store archived content
  output_dir: "./archive"
  
  # User agent for HTTP requests
  user_agent: "ChronosArchiver/1.0 (https://github.com/dodopok/ChronosArchiver)"
  
  # Maximum file size to download (in MB)
  max_file_size: 100
  
  # File types to archive (empty = all)
  allowed_mime_types:
    - "text/html"
    - "text/css"
    - "application/javascript"
    - "image/jpeg"
    - "image/png"
    - "image/gif"

# Queue configuration
queue:
  # Queue backend: redis, rabbitmq, or memory
  backend: "redis"
  
  # Redis settings (if backend is redis)
  redis_url: "redis://localhost:6379/0"
  redis_db: 0
  
  # Queue names
  discovery_queue: "chronos:discovery"
  ingestion_queue: "chronos:ingestion"
  transformation_queue: "chronos:transformation"
  indexing_queue: "chronos:indexing"
  
  # Queue settings
  max_queue_size: 10000
  message_ttl: 86400  # 24 hours in seconds

# Processing configuration
processing:
  # Number of concurrent workers per stage
  workers: 4
  
  # Batch size for processing
  batch_size: 10
  
  # Retry configuration
  retry_attempts: 3
  retry_delay: 5  # seconds
  retry_backoff: 2  # exponential backoff multiplier
  
  # Rate limiting
  requests_per_second: 5
  concurrent_requests: 10
  
  # Timeouts (in seconds)
  request_timeout: 30
  download_timeout: 300

# Database configuration
database:
  # Database type: sqlite or postgresql
  type: "sqlite"
  
  # SQLite settings
  sqlite_path: "./archive/chronos.db"
  
  # PostgreSQL settings (if type is postgresql)
  # postgresql_url: "postgresql://user:password@localhost:5432/chronos"
  
  # Connection pool settings
  pool_size: 5
  max_overflow: 10

# Discovery stage settings
discovery:
  # Wayback Machine CDX API endpoint
  cdx_api_url: "https://web.archive.org/cdx/search/cdx"
  
  # CDX query parameters
  cdx_params:
    output: "json"
    fl: "timestamp,original,mimetype,statuscode,digest,length"
  
  # Filters
  filter_status_codes: [200, 301, 302]
  deduplicate_snapshots: true

# Ingestion stage settings
ingestion:
  # Wayback Machine base URL
  wayback_url: "https://web.archive.org/web"
  
  # Download settings
  verify_ssl: true
  follow_redirects: true
  
  # Content validation
  validate_mime_type: true
  validate_content_hash: true

# Transformation stage settings
transformation:
  # Link rewriting
  rewrite_links: true
  make_links_relative: true
  
  # Metadata extraction
  extract_metadata: true
  extract_text: true
  
  # HTML processing
  prettify_html: false
  remove_scripts: false
  remove_comments: true

# Indexing stage settings
indexing:
  # Full-text search
  enable_full_text_search: true
  
  # Index fields
  index_fields:
    - "url"
    - "title"
    - "timestamp"
    - "content"
    - "metadata"
  
  # Storage format
  compress_content: true
  compression_level: 6

# Intelligence engine settings
intelligence:
  # Enable NLP processing
  enable_nlp: true
  
  # Enable named entity extraction
  enable_entity_extraction: true
  
  # Enable language detection
  enable_language_detection: true
  
  # Enable media embed detection
  enable_embed_detection: true

# Apache Tika settings
tika:
  # Enable Tika integration
  enabled: true
  
  # Tika server URL
  server_url: "http://localhost:9998"

# Search engine settings (Meilisearch)
search:
  # Meilisearch host
  meilisearch_host: "http://localhost:7700"
  
  # Meilisearch API key (optional)
  # meilisearch_api_key: "your_api_key"
  
  # Index name
  index_name: "chronos_archive"

# Web API settings
api:
  # Enable web API
  enabled: true
  
  # API host and port
  host: "0.0.0.0"
  port: 8000
  
  # Enable CORS
  enable_cors: true
  
  # Allowed origins for CORS
  cors_origins:
    - "*"

# Logging configuration
logging:
  # Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
  level: "INFO"
  
  # Log format
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  
  # Log to file
  log_to_file: true
  log_file: "./logs/chronos.log"
  
  # Log rotation
  rotate_logs: true
  max_log_size: 10485760  # 10 MB
  backup_count: 5

# Monitoring and metrics
monitoring:
  # Enable metrics collection
  enable_metrics: false
  
  # Prometheus settings
  prometheus_port: 8000
  
  # Health check endpoint
  health_check_enabled: true
  health_check_port: 8001